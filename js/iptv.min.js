/*! epg-focus v2.3.5 | (c) epg focus system | by ywwxly https://gitee.com/ywwxly/epg-focus /license */
function _debounce(t,e,i){var s;return function(){var n=this,o=arguments;if(s&&clearTimeout(s),i){var a=!s;s=setTimeout(function(){s=null},e),a&&t.apply(n,o)}else s=setTimeout(function(){t.apply(n,o)},e)}}function _throttle(t,e,i){var s,n=0;return i=i||1,function(){var o=this,a=arguments;if(1===i){var r=Date.now();r-n>e&&(t.apply(o,a),n=r)}else 2===i&&(s||(s=setTimeout(function(){s=null,t.apply(o,a)},e)))}}window.runTime=null,window.iptvFocus=function(t){t=t||{},this.viewEle=t.viewEle||this.viewEle,this._group=t._group||this._group,this.focusClassScale=t.focusClassScale||this.focusClassScale,this._nowEle=t.nowEle||this._nowEle,this.visualMargin=t.visualMargin||this.visualMargin,this._hasLayer=t.hasLayer||this._hasLayer;var e=location.pathname,i=e.split("/")[e.split("/").length-1];e=i.slice(0,i.indexOf(".")),this.pathname=e,this.animateHas=t.animateHas,this.initNoFocus=t.initNoFocus,this.isMoveScroll=t.isMoveScroll||this.isMoveScroll,iptvFocus.prototype.instance=this,this.init()},iptvFocus.prototype={version:"^2.3.5",keyEvent:!0,focusClassScale:1.1,visualMargin:30,isMoveScroll:!0,viewEle:document.getElementById("view")||document.body,_nowEle:null,_group:"column",_hasLayer:!1,_groupList:null,_foucsList:null,pathname:null,oldEleObj:null,defaultFocus:null,animateHas:!1,initNoFocus:!1,instance:null,getAttributeEle:function(t,e,i,s){for(var n=[],o=(e||document).getElementsByTagName(s||"*"),a=0,r=0;r<o.length;r++){var c=o[r];if(c.hasAttribute(t)){var u=c.getAttribute(t),l={index:r,focusIndex:a,ele:c,focus:u,groupName:i};if(u){var f=this.stringToJavascript(u);"function"==typeof f&&(l.focus=f)}c.hasAttribute("default-focus")&&(this._nowEle||(this._nowEle=l),this.defaultFocus=l),this.getEventAttribute(c,l,["blur","left","right","up","down","click","back"]),n.push(l),a++}}return n},getAttributeObj:function(t,e){function i(t,e,i){if(t[i]){var s=iptvFocus.prototype.stringToJavascript(t[i]);e[i]=s||t[i]}}for(var s={},n=document.getElementsByTagName(e||"*"),o=0;o<n.length;o++){var a=n[o];if(a.hasAttribute(t)){var r={},c={},u=a.getAttribute(t)||o;"string"==typeof u&&u.indexOf("}")>-1&&(r=this.stringToJavascript(u),u=r.name||o,i(r,c,"focus"),i(r,c,"blur")),c[t+"Name"]=u,c[t+"Ele"]=a,c.foucsList=this.getAttributeEle("isfocus",a,u),this.defaultFocus&&(c.defaultFocus=this.defaultFocus,this.defaultFocus=null),this.getEventAttribute(a,c,["left","right","up","down","click","back"]),s[u]=c}}return s},getEventAttribute:function(t,e,i){if("string"==typeof i){if(1==t.nodeType&&t.hasAttribute("@"+i)){var s=t.getAttribute("@"+i);if(s){var n=this.stringToJavascript(s);e[i]="function"==typeof n?n:s}}}else for(var o=0;o<i.length;o++)this.getEventAttribute(t,e,i[o])},getAllFocusList:function(t){function e(t,e){for(var i=0;i<e.length;i++)if(t.ele===e[i].ele)return!1;return!0}var i=[];t=Object.values(t||this._groupList);for(var s=0;s<t.length;s++)t[s].foucsList&&(i=i.concat(t[s].foucsList));if(!this._hasLayer){var n=this.getAttributeEle("isfocus",null,"no");if(t.length!=n.length){for(var o=[],a=0;a<n.length;a++)e(n[a],i)&&o.push(n[a]);i=i.concat(o),o.length>0&&(this._groupList.no={groupName:"no",groupEle:null,foucsList:o})}}return i},findFocusEle:function(t,e,i){var s=null,n=null;e=e||this._foucsList,"string"==typeof t?n=document.getElementById(t):"object"==typeof t&&(n=t);for(var o=0;o<e.length;o++){var a=e[o];if(n){if(n==a.ele){s=a;break}}else if("focusIndex"==i){if(t==a.focusIndex){s=a;break}}else if(t==a.index){s=a;break}}return s},focusGroup:function(t,e){this._groupList[t]&&this._groupList[t].foucsList.length>0&&(e?this.onFocus(this.findFocusEle(e,this._groupList[t].foucsList)):this.onFocus(this._groupList[t].defaultFocus||this._groupList[t].foucsList[0]))},init:function(){this.initFn(),this._groupList=this.getAttributeObj("group"),this._foucsList=this.getAllFocusList();var t=this.cookie(this.pathname);t&&(t=t.split("-"),this._nowEle=this.findFocusEle(t[1],this._groupList[t[0]].foucsList)),this._nowEle=this._nowEle||this._groupList[this._group].foucsList[0],this.initNoFocus||this.onFocus(this._nowEle)},onFocus:function(t,e){this.onBlur(e),this._nowEle=t;var i=t.focus;if(this._group=t.groupName,i)"function"==typeof i?this.callFn(i,t,this._group):this.addClass(t.ele,i);else{var s=this._groupList[this._group].focus;s?"string"==typeof s?this.addClass(t.ele,s):this.callFn(s,t,this._group):this.addClass(t.ele,"focus_btn")}},onBlur:function(t){t=t||this._nowEle;var e=t.groupName,i="function"!=typeof t.focus?t.focus:t.blur;if(t){if(i)"function"==typeof i?this.callFn(i,t,e):this.removeClass(t.ele,i);else{var s=this._groupList[e].blur;if(s)"string"==typeof s?this.removeClass(t.ele,s):this.callFn(s,t,e);else{var n="";this._groupList[e]&&this._groupList[e].focus&&(n=this._groupList[e].focus),this.removeClass(t.ele,("string"==typeof t.focus?t.focus:"")||n||"focus_btn")}}this.oldEleObj=t}},saveFocusIndex:function(t){t=t||this._nowEle,t&&this.cookie(this.pathname,t.groupName+"-"+t.index)},_dirKey:function(t){var e=this._nowEle[t];e?"function"==typeof e?this.callFn(e,this._nowEle,this._nowEle.groupName):this.onFocus(this.findFocusEle(e)):this.move(t)},_doKey:function(t){this._nowEle[t]?this.callFn(this._nowEle[t],this._nowEle,this._nowEle.groupName):this._groupList[this._nowEle.groupName][t]?this.callFn(this._groupList[this._nowEle.groupName][t],this._nowEle,this._nowEle.groupName):"back"==t&&"function"==typeof BackParent&&BackParent()},_down:function(){this._dirKey("down")},_up:function(){this._dirKey("up")},_right:function(){this._dirKey("right")},_left:function(){this._dirKey("left")},_back:function(){this.cutCookie(this.pathname),this._doKey("back")},_enter:function(){this.saveFocusIndex(),this._doKey("click")},callFn:function(t,e,i){var s=this.functionName(t);if(s)t(e,this.oldEleObj);else{var n=this.stringToJavascript(i);t.call(n,e,this.oldEleObj)}},move:function(t,e,i){var s=this.findMin(t,e);if(s.hasMin){var n=this._nowEle;return"left"===t||"right"===t?this._nowEle=s.min:"up"!==t&&"down"!==t||(this._nowEle=s.pref||s.min),this.isMoveScroll&&this.moveScroll(t,n),this.onFocus(this._nowEle,n),this._nowEle}if(this._groupList[this._group][t]){var o=this._groupList[this._group][t];"function"==typeof o?this.callFn(this._groupList[this._nowEle.groupName][t],this._nowEle,this._nowEle.groupName):this.concatGroupFocus(o,t)}else"noGroup"==i||this._hasLayer||this.move(t,this._foucsList,"noGroup")},findMin:function(t,e){var i,s,n,o;e=e||this._groupList[this._group].foucsList;for(var a=0;a<e.length;a++){var r=e[a],c=this.rules(this._nowEle,r,i,s,t);i=c.pDvalue,s=c.mDvalue,c.pref&&(n=r),c.min&&(o=r)}return{hasMin:(n||o)&&n!=this._nowEle&&o!=this._nowEle,pref:n,min:o}},concatGroupFocus:function(t,e){console.log(t,e,"concatGroupFocus"),console.log(this._groupList[t].foucsList),this._groupList[t]&&this._groupList[t].foucsList.length>0&&this.move(e,this._groupList[this._group].foucsList.concat(this._groupList[t].foucsList))},moveScroll:function(t,e){function i(t,e,i){function n(e){i?t.style.top=e+"px":t.style.left=e+"px"}var o=(new Date).getTime(),a="10_10";if(s.animateHas){var r=parseInt(a.split("_")[0]),c=parseInt(a.split("_")[1]);clearInterval(t.timeId),t.timeId=setInterval(function(){var s=(new Date).getTime()-o;if(console.log(s),s>=500)clearInterval(t.timeId),n(e);else{var a=i?t.offsetTop:t.offsetLeft,c=(e-a)/r;c=c>0?Math.ceil(c):Math.floor(c),a+=c,n(a),Math.abs(a-e)<10&&(n(e),clearInterval(t.timeId))}},c)}else n(e)}var s=this,n=this._groupList[this._nowEle.groupName].groupEle;n||(n=this._nowEle.ele.parentElement),n||(n=this.viewEle);var o,a,r=this.getBoundingClientRect(n),c=this.getBoundingClientRect(this._nowEle.ele),u=e?this.getBoundingClientRect(e.ele):{x:c.width-this.visualMargin,y:c.height-this.visualMargin},l=this.getBoundingClientRect(n.parentElement||this.viewEle),f="up"===t?c.y-l.y:c.y-l.y+c.height,h="left"===t?c.x-l.x:c.x-l.x+c.width,p=l.height||720,g=l.width||1280;if(f>=p)if("left"===t||"right"===t)e&&(this._nowEle=e);else{var _=this.findMin(t,this._groupList[this._nowEle.groupName].focusList);a=_.hasMin?(r.y>this.visualMargin?r.y:r.y-this.visualMargin)-l.y+(p-this.visualMargin)-f:r.y-l.y+(p-this.visualMargin)-f,i(n,a,"top")}else if(f<0){var E=r.y-l.y+u.y-c.y;if(E>0&&E<c.height&&(E=0),Math.abs(E)<this.visualMargin&&(E=0),E){_=this.findMin(t,this._groupList[this._nowEle.groupName].focusList);_.hasMin||(E=0)}i(n,E,"top"),a=E}if(h>g)"left"===t||"right"===t?(o=(r.x>this.visualMargin?r.x:r.x-this.visualMargin)-l.x+(g-this.visualMargin)-h,i(n,o)):e&&(this._nowEle=e);else if(h<0){var v=r.x-l.x+u.x-c.x;if(v>0&&v<c.width&&(v=0),Math.abs(v)<this.visualMargin&&(v=0),v){_=this.findMin(t,this._groupList[this._nowEle.groupName].focusList);_.hasMin||(v=0)}i(n,v),o=v}"function"==typeof moveScroll&&moveScroll({keyDir:t,X:o,Y:a})},getBoundingClientRect:function(t){function e(t){var i=t.offsetTop;return null!=t.offsetParent&&(i+=e(t.offsetParent)),i}function i(t){var e=t.offsetLeft;return null!=t.offsetParent&&(e+=i(t.offsetParent)),e}var s=i(t),n=e(t),o=t.offsetWidth,a=t.offsetHeight;return{top:n,bottom:n+a,left:s,right:s+o,width:t.offsetWidth,height:t.offsetHeight,x:s,y:n}},infos:function(t){var e=this.getBoundingClientRect(t);return{width:e.width,height:e.height,left:e.left,right:e.left+e.width,up:e.top,down:e.top+e.height,x:e.x,y:e.y}},distance:function(t,e,i,s){return parseInt(Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2)))},contains:function(t,e,i,s){return e-t+(s-i)>=Math.max(t,e,i,s)-Math.min(t,e,i,s)},rules:function(t,e,i,s,n){var o,a,r;if(pinfo=this.infos(t.ele),ninfo=this.infos(e.ele),ninfo.width||ninfo.height)if("up"===n){var c=pinfo.up+pinfo.height*(this.focusClassScale-1)/2+5;c>=ninfo.down&&(o=this.distance(ninfo.left,ninfo.up,pinfo.left,pinfo.up),(!s||o<s)&&(s=o,r=!0),(!i||this.contains(ninfo.left,ninfo.right,pinfo.left,pinfo.right)&&o<i)&&(i=o,a=!0))}else if("down"===n){var u=pinfo.down*(2-this.focusClassScale)-5;u<=ninfo.up&&(o=this.distance(ninfo.left,ninfo.up,pinfo.left,pinfo.up),(!s||o<s)&&(s=o,r=!0),(!i||this.contains(ninfo.left,ninfo.right,pinfo.left,pinfo.right)&&o<i)&&(i=o,a=!0))}else if("left"===n){var l=pinfo.left+pinfo.width*(this.focusClassScale-1)/2+5;l>=ninfo.right&&(o=this.distance(ninfo.right,ninfo.up,pinfo.left,pinfo.up),(!s||o<s)&&(s=o,r=!0),(!i||this.contains(ninfo.up,ninfo.down,pinfo.up,pinfo.down)&&o<i)&&(i=o,a=!0))}else if("right"===n){var f=pinfo.right*(2-this.focusClassScale)-5;f<=ninfo.left&&(o=this.distance(ninfo.left,ninfo.up,pinfo.left,pinfo.up),(!s||o<s)&&(s=o,r=!0),(!i||this.contains(ninfo.up,ninfo.down,pinfo.up,pinfo.down)&&o<i)&&(i=o,a=!0))}return{pDvalue:i,mDvalue:s,pref:a,min:r}},functionName:function(t){var e=t.toString(),i=/function\s*(\w*)/i,s=i.exec(e);return e=s[1],e},stringToJavascript:function(string){try{return eval("("+string+")")}catch(t){return!1}},initFn:function(){function t(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}var e,i,s,n,o,a,r;"undefined"!=typeof iPanel&&(iPanel.focus.borders="0",iPanel.focusWidth="0",iPanel.defaultFocusColor="transparent"),Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=s.length,function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var o=[];for(var a in t)e.call(t,a)&&o.push(a);if(i)for(var r=0;r<n;r++)e.call(t,s[r])&&o.push(s[r]);return o})),Object.values||(Object.values=function(t){if(t!==Object(t))throw new TypeError("Object.values called on a non-object");var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(t[e]);return i}),"classList"in document.documentElement?(o=function(t,e){return t.classList.contains(e)},a=function(t,e){t.classList.add(e)},r=function(e,i){e.className=e.className.replace(t(i)," ")}):"className"in document.documentElement?(o=function(e,i){return t(i).test(e.className)},a=function(t,e){o(t,e)||(t.className=t.className+" "+e)},r=function(e,i){e.className=e.className.replace(t(i)," ")}):(o=function(e,i){return t(i).test(e.getAttribute("class"))},a=function(t,e){o(t,e)||t.setAttribute("class",t.getAttribute("class")+" "+e)},r=function(e,i){e.setAttribute("class",e.getAttribute("class").replace(t(i)," "))}),iptvFocus.prototype.hasClass=o,iptvFocus.prototype.addClass=a,iptvFocus.prototype.removeClass=r,document.onkeydown=this.STB_Key},cookie:function(t,e,i,s){if(!e)return this.getCookie(t.toString());var n=new Date;i||(i=1,n.setDate(n.getDate()+i)),document.cookie=t+"="+escape(e)+";expires="+n.toGMTString()+";path="+(s||"/")+";"},getCookie:function(t){if(document.cookie.length>0)return c_start=document.cookie.indexOf(t+"="),-1!=c_start?(c_start=c_start+t.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):null},cutCookie:function(t,e){var i=new Date;i.setTime(i.getTime()-864e5),document.cookie=t+"=;expires="+i.toGMTString()+";path="+(e||"/")+";"},STB_Key:function(t,e){t=t||window.event;var i="",s=!1,n=t.keyCode||t.which||t.charCode||t;switch(n){case 3:case 29:case 37:case 65361:i="KEY_LEFT";break;case 1:case 28:case 38:case 65362:i="KEY_UP";break;case 4:case 30:case 39:case 65363:i="KEY_RIGHT";break;case 2:case 31:case 40:case 65364:i="KEY_DOWN";break;case 33:i="KEY_PAGEUP";break;case 34:i="KEY_PAGEDOWN";break;case 8:case 32:case 122:case 270:case 340:case 640:case 65367:i="KEY_BACK";break;case 13:case 65293:i="KEY_ENTER";break;case 15:i="KEY_SPACEBAR";break;case 48:case 96:i="KEY_0";break;case 49:case 97:i="KEY_1";break;case 50:case 98:i="KEY_2";break;case 51:case 99:i="KEY_3";break;case 52:case 100:i="KEY_4";break;case 53:case 101:i="KEY_5";break;case 54:case 102:i="KEY_6";break;case 55:case 103:i="KEY_7";break;case 56:case 104:i="KEY_8";break;case 57:case 105:i="KEY_9";break;case 259:i="KEY_VOL_UP";break;case 260:i="KEY_VOL_DOWN";break;case 261:i="KEY_MUTE";break;case 262:i="KEY_TRACK";break;case 263:i="KEY_PAUSE_PLAY";break;case 264:i="KEY_FAST_FORWARD";break;case 265:i="KEY_FAST_REWIND";break;case 266:i="KEY_GO_END";break;case 267:i="KEY_GO_BEGINNING";break;case 268:i="KEY_INFO";break;case 269:i="KEY_INTERX";break;case 270:i="KEY_STOP";break;case 271:i="KEY_POS";break;case 1105:i="KEY_SEARCH";break;case 1240:i="KEY_CAPTION";break;case 1246:i="KEY_INTERACTIVE";break;case 768:if("object"!=typeof Utility||!("getEvent"in Utility))return;var o=Utility.getEvent(),a=o.type;if(void 0===a||""==a){var r=new Array;r=o.split(",");var c=r[0],u=c.indexOf(":")+2;a=c.substring(u,c.length-1)}switch(a){case"EVENT_MEDIA_ERROR":i="EVENT_MEDIA_ERROR";break;case"EVENT_MEDIA_END":i="EVENT_MEDIA_END"}break;default:i=""}s&&(t.preventDefault?t.preventDefault():t.returnValue?t.returnValue=!1:t.stopPropagation&&evt.stopPropagation()),iptvFocus.prototype.keyEvents(i,iptvFocus.prototype.instance)},keyEvents:_throttle(function(t,e){if(e)switch(!e.keyEvent&&["KEY_LEFT","KEY_RIGHT","KEY_DOWN","KEY_UP"].indexOf(t)>-1&&(t="NOTEVENT"),t){case"KEY_LEFT":"function"==typeof e._left&&e._left();break;case"KEY_RIGHT":"function"==typeof e._right&&e._right();break;case"KEY_DOWN":"function"==typeof e._down&&e._down();break;case"KEY_UP":"function"==typeof e._up&&e._up();break;case"KEY_ENTER":"function"==typeof e._enter&&e._enter();break;case"KEY_BACK":"function"==typeof e._back?e._back():this.BackParent();break;default:"function"==typeof this.mediaEvent&&this.mediaEvent(t)}},350)};