/*! epg-focus v1.1.3 | (c) epg focus system |by XUZHEN https://gitee.com/ywwxly/epg-focus /license */ function iptvFocus(t){t=t||{},this.viewEle=t.viewEle||this.viewEle,this._group=t._group||this._group,this.focusClassScale=t.focusClassScale||this.focusClassScale,this._nowEle=t.nowEle||this._nowEle,this.visualMargin=t.visualMargin||this.visualMargin,this._hasLayer=t.hasLayer||this._hasLayer;var i=location.pathname,e=i.split("/")[i.split("/").length-1];i=e.slice(0,e.indexOf(".")),this.pathname=i,this.init()}function functionName(t){var i=t.toString();return i=i.substr("function ".length),i=i.substr(0,i.indexOf("(")),i}function stringToJavascript(string){try{return eval("("+string+")")}catch(t){return!1}}function getTop(t){var i=t.offsetTop;return null!=t.offsetParent&&(i+=getTop(t.offsetParent)),i}function getLeft(t){var i=t.offsetLeft;return null!=t.offsetParent&&(i+=getLeft(t.offsetParent)),i}window.runTime=null,iptvFocus.prototype={version:"1.1.3",focusClassScale:1.1,visualMargin:30,viewEle:evm.$("view")||document.body,_nowEle:null,_group:"column",_hasLayer:!1,_groupList:null,_foucsList:null,pathname:null,oldEleObj:null,defaultFocus:null,getAttributeEle:function(t,i,e,n){rootEle=(i||document).getElementsByTagName(n||"*");for(var s=[],o=Object.values(rootEle),u=0,r=0;r<o.length;r++){var l=o[r];if(1==l.nodeType&&l.hasAttribute(t)){var f=l.getAttribute(t),a={index:r,focusIndex:u,ele:l,focus:f,groupName:e};if(f){var h=stringToJavascript(f);"function"==typeof h&&(a.focus=h)}l.hasAttribute("default-focus")&&(this._nowEle||(this._nowEle=a),this.defaultFocus=a),this.getEventAttribute(l,a,["blur","left","right","up","down","click","back"]),s.push(a),u++}}return s},getAttributeObj:function(t,i){function e(t,i,e){if(t[e]){var n=stringToJavascript(t[e]);i[e]=n||t[e]}}for(var n=document.getElementsByTagName(i||"*"),s={},o=Object.values(n),u=0;u<o.length;u++){var r=o[u];if(1==r.nodeType&&r.hasAttribute(t)){var l={},f={},a=r.getAttribute(t)||u;"string"==typeof a&&a.indexOf("}")>-1&&(l=stringToJavascript(a),a=l.name||u,e(l,f,"focus"),e(l,f,"blur")),f[t+"Name"]=a,f[t+"Ele"]=r,f.foucsList=this.getAttributeEle("isfocus",r,a),this.defaultFocus&&(f.defaultFocus=this.defaultFocus,this.defaultFocus=null),this.getEventAttribute(r,f,["left","right","up","down","click","back"]),s[a]=f}}return s},getEventAttribute:function(t,i,e){if("string"==typeof e){if(1==t.nodeType&&t.hasAttribute("@"+e)){var n=t.getAttribute("@"+e);if(n){var s=stringToJavascript(n);i[e]="function"==typeof s?s:n}}}else for(var o=0;o<e.length;o++)this.getEventAttribute(t,i,e[o])},getAllFocusList:function(t){function i(t,i){for(var e=0;e<i.length;e++)if(t.ele===i[e].ele)return!1;return!0}var e=[];t=Object.values(t||this._groupList);for(var n=0;n<t.length;n++)t[n].foucsList&&(e=e.concat(t[n].foucsList));if(!this._hasLayer){var s=this.getAttributeEle("isfocus",null,"no");if(t.length!=s.length){for(var o=[],u=0;u<s.length;u++)i(s[u],e)&&o.push(s[u]);e=e.concat(o),o.length>0&&(this._groupList.no={groupName:"no",groupEle:null,foucsList:o})}}return e},findFocusEle:function(t,i){var e=null,n=null;i=i||this._foucsList,"string"==typeof t?n=document.getElementById(t):"object"==typeof t&&(n=t);for(var s=0;s<i.length;s++){var o=i[s];if(n){if(n==o.ele){e=o;break}}else if(t==o.index){e=o;break}}return e},focusGroup:function(t,i){i?this.onFocus(this.findFocusEle(i,this._groupList[t].foucsList)):this.onFocus(this._groupList[t].defaultFocus||this._groupList[t].foucsList[0])},init:function(){this._groupList=this.getAttributeObj("group");var t=evm.cookie(this.pathname);t&&(t=t.split("-"),this._nowEle=this.findFocusEle(t[1],this._groupList[t[0]].foucsList)),this._nowEle=this._nowEle||this._groupList[this._group].foucsList[0],this.onFocus(this._nowEle),this._foucsList=this.getAllFocusList(),runTime=(new Date).getTime()-runTime},onFocus:function(t,i){i=i||this._nowEle,this._nowEle=t;var e=i.groupName,n=i.blur;if(i){if(n)"function"==typeof n?this.callFn(n,i,e):evm.removeClass(i.ele,n);else{var s=this._groupList[e].blur;if(s)"string"==typeof s?evm.removeClass(i.ele,s):this.callFn(s,i,e);else{var o="";this._groupList[e]&&this._groupList[e].focus&&(o=this._groupList[e].focus),evm.removeClass(i.ele,("string"==typeof i.focus?i.focus:"")||o||"focus_btn")}}this.oldEleObj=i}var u=t.focus;if(this._group=t.groupName,u)"function"==typeof u?this.callFn(u,t,this._group):evm.addClass(t.ele,u);else{var r=this._groupList[this._group].focus;r?"string"==typeof r?evm.addClass(t.ele,r):this.callFn(r,t,this._group):evm.addClass(t.ele,"focus_btn")}},saveFocusIndex:function(t){t=t||this._nowEle,t&&evm.cookie(this.pathname,t.groupName+"-"+t.index)},_dirKey:function(t){var i=this._nowEle[t];i?"function"==typeof i?this.callFn(i,this._nowEle,this._nowEle.groupName):this.onFocus(this.findFocusEle(i)):this.move(t)},_doKey:function(t){this._nowEle[t]?this.callFn(this._nowEle[t],this._nowEle,this._nowEle.groupName):this._groupList[this._nowEle.groupName][t]?this.callFn(this._groupList[this._nowEle.groupName][t],this._nowEle,this._nowEle.groupName):"back"==t&&"function"==typeof BackParent&&BackParent()},_down:function(){this._dirKey("down")},_up:function(){this._dirKey("up")},_right:function(){this._dirKey("right")},_left:function(){this._dirKey("left")},_back:function(){evm.cutCookie(this.pathname),this._doKey("back")},_enter:function(){this.saveFocusIndex(),this._doKey("click")},callFn:function(t,i,e){var n=functionName(t);if(n)t(i,this.oldEleObj);else{var s=stringToJavascript(e);t.call(s,i,this.oldEleObj)}},move:function(t,i,e){var n,s,o,u;i=i||this._groupList[this._group].foucsList;for(var r=0;r<i.length;r++){item=i[r];var l=this.rules(this._nowEle,item,n,s,t);n=l.pDvalue,s=l.mDvalue,l.pref&&(o=item),l.min&&(u=item)}if(o||u){var f=this._nowEle;return"left"===t||"right"===t?this._nowEle=u:"up"!==t&&"down"!==t||(this._nowEle=o||u),this.moveScroll(t,f),this.onFocus(this._nowEle,f),this._nowEle}if(this._groupList[this._group][t]){var a=this._groupList[this._group][t];this.move(t,this._groupList[this._group].foucsList.concat(this._groupList[a].foucsList))}else"noGroup"==e||this._hasLayer||this.move(t,this._foucsList,"noGroup")},moveScroll:function(t,i){var e=this._groupList[this._nowEle.groupName].groupEle;e||(e=this._nowEle.ele.parentElement),e||(e=this.viewEle);var n=this.getBoundingClientRect(e),s=this.getBoundingClientRect(this._nowEle.ele),o=i?this.getBoundingClientRect(i.ele):{x:s.width-this.visualMargin,y:s.height-this.visualMargin},u=this.getBoundingClientRect(e.parentElement||this.viewEle),r="up"===t?s.y-u.y:s.y-u.y+s.height,l="left"===t?s.x-u.x:s.x-u.x+s.width,f=u.height||720,a=u.width||1280;if(r>=f)"left"===t||"right"===t?i&&(this._nowEle=i):e.style.top=(n.y>this.visualMargin?n.y:n.y-this.visualMargin)-u.y+(f-this.visualMargin)-r+"px";else if(r<0){var h=n.y-u.y+o.y-s.y;h>0&&h<s.height&&(h=0),Math.abs(h)<this.visualMargin&&(h=0),e.style.top=h+"px"}if(l>a)"left"===t||"right"===t?e.style.left=(n.x>this.visualMargin?n.x:n.x-this.visualMargin)-u.x+(a-this.visualMargin)-l+"px":i&&(this._nowEle=i);else if(l<0){var c=n.x-u.x+o.x-s.x;c>0&&c<s.width&&(c=0),Math.abs(c)<this.visualMargin&&(c=0),e.style.left=c+"px"}},getBoundingClientRect:function(t){var i=getLeft(t),e=getTop(t),n=t.offsetWidth,s=t.offsetHeight;return{top:e,bottom:e+s,left:i,right:i+n,width:t.offsetWidth,height:t.offsetHeight,x:i,y:e}},infos:function(t){var i=this.getBoundingClientRect(t);return{width:i.width,height:i.height,left:i.left,right:i.left+i.width,up:i.top,down:i.top+i.height,x:i.x,y:i.y}},distance:function(t,i,e,n){return parseInt(Math.sqrt(Math.pow(t-e,2)+Math.pow(i-n,2)))},contains:function(t,i,e,n){return i-t+(n-e)>=Math.max(t,i,e,n)-Math.min(t,i,e,n)},rules:function(t,i,e,n,s){var o,u,r;if(pinfo=this.infos(t.ele),ninfo=this.infos(i.ele),ninfo.width||ninfo.height)if("up"===s){var l=pinfo.up+pinfo.height*(this.focusClassScale-1)/2+5;l>=ninfo.down&&(o=this.distance(ninfo.left,ninfo.up,pinfo.left,pinfo.up),(!n||o<n)&&(n=o,r=!0),(!e||this.contains(ninfo.left,ninfo.right,pinfo.left,pinfo.right)&&o<e)&&(e=o,u=!0))}else if("down"===s){var f=pinfo.down*(2-this.focusClassScale)-5;f<=ninfo.up&&(o=this.distance(ninfo.left,ninfo.up,pinfo.left,pinfo.up),(!n||o<n)&&(n=o,r=!0),(!e||this.contains(ninfo.left,ninfo.right,pinfo.left,pinfo.right)&&o<e)&&(e=o,u=!0))}else if("left"===s){var a=pinfo.left+pinfo.width*(this.focusClassScale-1)/2+5;a>=ninfo.right&&(o=this.distance(ninfo.right,ninfo.up,pinfo.left,pinfo.up),(!n||o<n)&&(n=o,r=!0),(!e||this.contains(ninfo.up,ninfo.down,pinfo.up,pinfo.down)&&o<e)&&(e=o,u=!0))}else if("right"===s){var h=pinfo.right*(2-this.focusClassScale)-5;h<=ninfo.left&&(o=this.distance(ninfo.left,ninfo.up,pinfo.left,pinfo.up),(!n||o<n)&&(n=o,r=!0),(!e||this.contains(ninfo.up,ninfo.down,pinfo.up,pinfo.down)&&o<e)&&(e=o,u=!0))}return{pDvalue:e,mDvalue:n,pref:u,min:r}}},window.keyevent=function(){var t=iptv;if(t)switch(_keyName){case"KEY_LEFT":"function"==typeof t._left&&t._left();break;case"KEY_RIGHT":"function"==typeof t._right&&t._right();break;case"KEY_DOWN":"function"==typeof t._down&&t._down();break;case"KEY_UP":"function"==typeof t._up&&t._up();break;case"KEY_ENTER":"function"==typeof t._enter&&t._enter();break;case"KEY_BACK":"function"==typeof t._back?t._back():BackParent()}};